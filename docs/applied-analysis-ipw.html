<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Topic 13 Applied Analysis: IPW | STAT 451: Causal Inference</title>
  <meta name="description" content="This is the class website for Causal Inference (STAT 451) at Macalester College." />
  <meta name="generator" content="bookdown 0.32 and GitBook 2.6.7" />

  <meta property="og:title" content="Topic 13 Applied Analysis: IPW | STAT 451: Causal Inference" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="This is the class website for Causal Inference (STAT 451) at Macalester College." />
  <meta name="github-repo" content="lmyint/causal_spring_2023" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Topic 13 Applied Analysis: IPW | STAT 451: Causal Inference" />
  
  <meta name="twitter:description" content="This is the class website for Causal Inference (STAT 451) at Macalester College." />
  




  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="ipw-simulation.html"/>
<link rel="next" href="time-varying-treatments-and-mediation-analysis.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="custom_styles.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href = "./">STAT 451: Causal Inference</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Welcome!</a></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a>
<ul>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html#required-references"><i class="fa fa-check"></i>Required references</a></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html#references-for-review"><i class="fa fa-check"></i>References for review</a></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html#further-exploration"><i class="fa fa-check"></i>Further exploration</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="schedule.html"><a href="schedule.html"><i class="fa fa-check"></i>Schedule</a></li>
<li class="chapter" data-level="" data-path="guiding-questions.html"><a href="guiding-questions.html"><i class="fa fa-check"></i>Guiding Questions</a></li>
<li class="part"><span><b>I Foundational Ideas</b></span></li>
<li class="chapter" data-level="1" data-path="motivation-and-review.html"><a href="motivation-and-review.html"><i class="fa fa-check"></i><b>1</b> Motivation and Review</a>
<ul>
<li class="chapter" data-level="" data-path="motivation-and-review.html"><a href="motivation-and-review.html#discussion-prompts"><i class="fa fa-check"></i>Discussion prompts</a>
<ul>
<li class="chapter" data-level="" data-path="motivation-and-review.html"><a href="motivation-and-review.html#considering-causes"><i class="fa fa-check"></i>Considering causes</a></li>
<li class="chapter" data-level="" data-path="motivation-and-review.html"><a href="motivation-and-review.html#sinful-saying-or-mandatory-mantra"><i class="fa fa-check"></i>Sinful saying or mandatory mantra?</a></li>
<li class="chapter" data-level="" data-path="motivation-and-review.html"><a href="motivation-and-review.html#sufficiency-and-necessity"><i class="fa fa-check"></i>Sufficiency and necessity</a></li>
<li class="chapter" data-level="" data-path="motivation-and-review.html"><a href="motivation-and-review.html#evaluating-evidence-for-causation-bradford-hill-criteria"><i class="fa fa-check"></i>Evaluating evidence for causation: Bradford Hill criteria</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="exchangeability.html"><a href="exchangeability.html"><i class="fa fa-check"></i><b>2</b> Exchangeability</a>
<ul>
<li class="chapter" data-level="" data-path="exchangeability.html"><a href="exchangeability.html#learning-goals"><i class="fa fa-check"></i>Learning Goals</a></li>
<li class="chapter" data-level="" data-path="exchangeability.html"><a href="exchangeability.html#exercises"><i class="fa fa-check"></i>Exercises</a>
<ul>
<li class="chapter" data-level="" data-path="exchangeability.html"><a href="exchangeability.html#exercise-1"><i class="fa fa-check"></i>Exercise 1</a></li>
<li class="chapter" data-level="" data-path="exchangeability.html"><a href="exchangeability.html#exercise-2"><i class="fa fa-check"></i>Exercise 2</a></li>
<li class="chapter" data-level="" data-path="exchangeability.html"><a href="exchangeability.html#exercise-3"><i class="fa fa-check"></i>Exercise 3</a></li>
<li class="chapter" data-level="" data-path="exchangeability.html"><a href="exchangeability.html#exercise-4"><i class="fa fa-check"></i>Exercise 4</a></li>
<li class="chapter" data-level="" data-path="exchangeability.html"><a href="exchangeability.html#exercise-5"><i class="fa fa-check"></i>Exercise 5</a></li>
<li class="chapter" data-level="" data-path="exchangeability.html"><a href="exchangeability.html#exercise-6-extra"><i class="fa fa-check"></i>Exercise 6 (Extra)</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="exchangeability.html"><a href="exchangeability.html#exercise-7-extra"><i class="fa fa-check"></i>Exercise 7 (Extra)</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="study-designs.html"><a href="study-designs.html"><i class="fa fa-check"></i><b>3</b> Study Designs</a>
<ul>
<li class="chapter" data-level="" data-path="study-designs.html"><a href="study-designs.html#learning-goals-1"><i class="fa fa-check"></i>Learning goals</a></li>
<li class="chapter" data-level="" data-path="study-designs.html"><a href="study-designs.html#exercises-1"><i class="fa fa-check"></i>Exercises</a>
<ul>
<li class="chapter" data-level="" data-path="study-designs.html"><a href="study-designs.html#peer-check-in"><i class="fa fa-check"></i>Peer check-in</a></li>
<li class="chapter" data-level="" data-path="study-designs.html"><a href="study-designs.html#exercise-1-1"><i class="fa fa-check"></i>Exercise 1</a></li>
<li class="chapter" data-level="" data-path="study-designs.html"><a href="study-designs.html#exercise-2-1"><i class="fa fa-check"></i>Exercise 2</a></li>
<li class="chapter" data-level="" data-path="study-designs.html"><a href="study-designs.html#exercise-3-1"><i class="fa fa-check"></i>Exercise 3</a></li>
<li class="chapter" data-level="" data-path="study-designs.html"><a href="study-designs.html#extra"><i class="fa fa-check"></i>Extra</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>II Causal Graphs</b></span></li>
<li class="chapter" data-level="4" data-path="causal-graphs-as-statistical-models.html"><a href="causal-graphs-as-statistical-models.html"><i class="fa fa-check"></i><b>4</b> Causal Graphs as Statistical Models</a>
<ul>
<li class="chapter" data-level="" data-path="causal-graphs-as-statistical-models.html"><a href="causal-graphs-as-statistical-models.html#learning-goals-2"><i class="fa fa-check"></i>Learning Goals</a></li>
<li class="chapter" data-level="" data-path="causal-graphs-as-statistical-models.html"><a href="causal-graphs-as-statistical-models.html#simulating-data-in-r"><i class="fa fa-check"></i>Simulating data in R</a>
<ul>
<li class="chapter" data-level="" data-path="causal-graphs-as-statistical-models.html"><a href="causal-graphs-as-statistical-models.html#why-simulate"><i class="fa fa-check"></i>Why simulate?</a></li>
<li class="chapter" data-level="" data-path="causal-graphs-as-statistical-models.html"><a href="causal-graphs-as-statistical-models.html#simulation-functions-in-r"><i class="fa fa-check"></i>Simulation functions in R</a></li>
<li class="chapter" data-level="" data-path="causal-graphs-as-statistical-models.html"><a href="causal-graphs-as-statistical-models.html#simulating-data-from-graphssems"><i class="fa fa-check"></i>Simulating data from graphs+SEMs</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="causal-graphs-as-statistical-models.html"><a href="causal-graphs-as-statistical-models.html#exercises-2"><i class="fa fa-check"></i>Exercises</a>
<ul>
<li class="chapter" data-level="" data-path="causal-graphs-as-statistical-models.html"><a href="causal-graphs-as-statistical-models.html#exercise-1-2"><i class="fa fa-check"></i>Exercise 1</a></li>
<li class="chapter" data-level="" data-path="causal-graphs-as-statistical-models.html"><a href="causal-graphs-as-statistical-models.html#extra-1"><i class="fa fa-check"></i>Extra</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="key-structures-in-causal-graphs.html"><a href="key-structures-in-causal-graphs.html"><i class="fa fa-check"></i><b>5</b> Key Structures in Causal Graphs</a>
<ul>
<li class="chapter" data-level="" data-path="key-structures-in-causal-graphs.html"><a href="key-structures-in-causal-graphs.html#learning-goals-3"><i class="fa fa-check"></i>Learning Goals</a></li>
<li class="chapter" data-level="" data-path="key-structures-in-causal-graphs.html"><a href="key-structures-in-causal-graphs.html#exercises-3"><i class="fa fa-check"></i>Exercises</a>
<ul>
<li class="chapter" data-level="" data-path="key-structures-in-causal-graphs.html"><a href="key-structures-in-causal-graphs.html#exercise-1-3"><i class="fa fa-check"></i>Exercise 1</a></li>
<li class="chapter" data-level="" data-path="key-structures-in-causal-graphs.html"><a href="key-structures-in-causal-graphs.html#exercise-2-2"><i class="fa fa-check"></i>Exercise 2</a></li>
<li class="chapter" data-level="" data-path="key-structures-in-causal-graphs.html"><a href="key-structures-in-causal-graphs.html#exercise-3-2"><i class="fa fa-check"></i>Exercise 3</a></li>
<li class="chapter" data-level="" data-path="key-structures-in-causal-graphs.html"><a href="key-structures-in-causal-graphs.html#exercise-4-1"><i class="fa fa-check"></i>Exercise 4</a></li>
<li class="chapter" data-level="" data-path="key-structures-in-causal-graphs.html"><a href="key-structures-in-causal-graphs.html#extra-2"><i class="fa fa-check"></i>Extra</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="graphical-structure-of-confounding.html"><a href="graphical-structure-of-confounding.html"><i class="fa fa-check"></i><b>6</b> Graphical Structure of Confounding</a>
<ul>
<li class="chapter" data-level="" data-path="graphical-structure-of-confounding.html"><a href="graphical-structure-of-confounding.html#learning-goals-4"><i class="fa fa-check"></i>Learning Goals</a></li>
<li class="chapter" data-level="" data-path="graphical-structure-of-confounding.html"><a href="graphical-structure-of-confounding.html#exercises-4"><i class="fa fa-check"></i>Exercises</a>
<ul>
<li class="chapter" data-level="" data-path="graphical-structure-of-confounding.html"><a href="graphical-structure-of-confounding.html#exercise-1-4"><i class="fa fa-check"></i>Exercise 1</a></li>
<li class="chapter" data-level="" data-path="graphical-structure-of-confounding.html"><a href="graphical-structure-of-confounding.html#exercise-2-3"><i class="fa fa-check"></i>Exercise 2</a></li>
<li class="chapter" data-level="" data-path="graphical-structure-of-confounding.html"><a href="graphical-structure-of-confounding.html#exercise-3-3"><i class="fa fa-check"></i>Exercise 3</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="graphical-structure-of-selection-bias.html"><a href="graphical-structure-of-selection-bias.html"><i class="fa fa-check"></i><b>7</b> Graphical Structure of Selection Bias</a>
<ul>
<li class="chapter" data-level="" data-path="graphical-structure-of-selection-bias.html"><a href="graphical-structure-of-selection-bias.html#learning-goals-5"><i class="fa fa-check"></i>Learning Goals</a></li>
<li class="chapter" data-level="" data-path="graphical-structure-of-selection-bias.html"><a href="graphical-structure-of-selection-bias.html#exercises-5"><i class="fa fa-check"></i>Exercises</a>
<ul>
<li class="chapter" data-level="" data-path="graphical-structure-of-selection-bias.html"><a href="graphical-structure-of-selection-bias.html#exercise-1-5"><i class="fa fa-check"></i>Exercise 1</a></li>
<li class="chapter" data-level="" data-path="graphical-structure-of-selection-bias.html"><a href="graphical-structure-of-selection-bias.html#exercise-2-4"><i class="fa fa-check"></i>Exercise 2</a></li>
<li class="chapter" data-level="" data-path="graphical-structure-of-selection-bias.html"><a href="graphical-structure-of-selection-bias.html#exercise-3-4"><i class="fa fa-check"></i>Exercise 3</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="the-smoking-birth-weight-paradox.html"><a href="the-smoking-birth-weight-paradox.html"><i class="fa fa-check"></i><b>8</b> The Smoking-Birth Weight Paradox</a>
<ul>
<li class="chapter" data-level="" data-path="the-smoking-birth-weight-paradox.html"><a href="the-smoking-birth-weight-paradox.html#our-task"><i class="fa fa-check"></i>Our Task</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="building-causal-graphs-for-applied-analyses.html"><a href="building-causal-graphs-for-applied-analyses.html"><i class="fa fa-check"></i><b>9</b> Building Causal Graphs for Applied Analyses</a>
<ul>
<li class="chapter" data-level="" data-path="building-causal-graphs-for-applied-analyses.html"><a href="building-causal-graphs-for-applied-analyses.html#learning-goals-6"><i class="fa fa-check"></i>Learning Goals</a></li>
<li class="chapter" data-level="" data-path="building-causal-graphs-for-applied-analyses.html"><a href="building-causal-graphs-for-applied-analyses.html#exercises-6"><i class="fa fa-check"></i>Exercises</a>
<ul>
<li class="chapter" data-level="" data-path="building-causal-graphs-for-applied-analyses.html"><a href="building-causal-graphs-for-applied-analyses.html#data-context"><i class="fa fa-check"></i>Data context</a></li>
<li class="chapter" data-level="" data-path="building-causal-graphs-for-applied-analyses.html"><a href="building-causal-graphs-for-applied-analyses.html#collaborative-causal-graph-construction"><i class="fa fa-check"></i>Collaborative causal graph construction</a></li>
<li class="chapter" data-level="" data-path="building-causal-graphs-for-applied-analyses.html"><a href="building-causal-graphs-for-applied-analyses.html#incorporate-information-on-available-variables"><i class="fa fa-check"></i>Incorporate information on available variables</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>III Estimation</b></span></li>
<li class="chapter" data-level="10" data-path="applied-analysis-regression.html"><a href="applied-analysis-regression.html"><i class="fa fa-check"></i><b>10</b> Applied Analysis: Regression</a>
<ul>
<li class="chapter" data-level="" data-path="applied-analysis-regression.html"><a href="applied-analysis-regression.html#learning-goals-7"><i class="fa fa-check"></i>Learning Goals</a></li>
<li class="chapter" data-level="" data-path="applied-analysis-regression.html"><a href="applied-analysis-regression.html#analysis"><i class="fa fa-check"></i>Analysis</a>
<ul>
<li class="chapter" data-level="" data-path="applied-analysis-regression.html"><a href="applied-analysis-regression.html#data-context-and-research-questions"><i class="fa fa-check"></i>Data context and research questions</a></li>
<li class="chapter" data-level="" data-path="applied-analysis-regression.html"><a href="applied-analysis-regression.html#part-1-finalize-adjustment-set"><i class="fa fa-check"></i>Part 1: Finalize adjustment set</a></li>
<li class="chapter" data-level="" data-path="applied-analysis-regression.html"><a href="applied-analysis-regression.html#part-2-exploratory-analysis"><i class="fa fa-check"></i>Part 2: Exploratory analysis</a></li>
<li class="chapter" data-level="" data-path="applied-analysis-regression.html"><a href="applied-analysis-regression.html#part-3-modeling"><i class="fa fa-check"></i>Part 3: Modeling</a></li>
<li class="chapter" data-level="" data-path="applied-analysis-regression.html"><a href="applied-analysis-regression.html#part-4-interpretation-and-discussion"><i class="fa fa-check"></i>Part 4: Interpretation and discussion</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="applied-analysis-regression.html"><a href="applied-analysis-regression.html#simulation-study-planning"><i class="fa fa-check"></i>Simulation study planning</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="inverse-probability-weighting.html"><a href="inverse-probability-weighting.html"><i class="fa fa-check"></i><b>11</b> Inverse Probability Weighting</a>
<ul>
<li class="chapter" data-level="" data-path="inverse-probability-weighting.html"><a href="inverse-probability-weighting.html#learning-goals-8"><i class="fa fa-check"></i>Learning Goals</a></li>
<li class="chapter" data-level="" data-path="inverse-probability-weighting.html"><a href="inverse-probability-weighting.html#exercises-7"><i class="fa fa-check"></i>Exercises</a>
<ul>
<li class="chapter" data-level="" data-path="inverse-probability-weighting.html"><a href="inverse-probability-weighting.html#exercise-1-6"><i class="fa fa-check"></i>Exercise 1</a></li>
<li class="chapter" data-level="" data-path="inverse-probability-weighting.html"><a href="inverse-probability-weighting.html#exercise-2-5"><i class="fa fa-check"></i>Exercise 2</a></li>
<li class="chapter" data-level="" data-path="inverse-probability-weighting.html"><a href="inverse-probability-weighting.html#exercise-3-5"><i class="fa fa-check"></i>Exercise 3</a></li>
<li class="chapter" data-level="" data-path="inverse-probability-weighting.html"><a href="inverse-probability-weighting.html#exercise-4-2"><i class="fa fa-check"></i>Exercise 4</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="inverse-probability-weighting.html"><a href="inverse-probability-weighting.html#debrief"><i class="fa fa-check"></i>Debrief</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="ipw-simulation.html"><a href="ipw-simulation.html"><i class="fa fa-check"></i><b>12</b> IPW: Simulation</a>
<ul>
<li class="chapter" data-level="" data-path="ipw-simulation.html"><a href="ipw-simulation.html#learning-goals-9"><i class="fa fa-check"></i>Learning Goals</a></li>
<li class="chapter" data-level="" data-path="ipw-simulation.html"><a href="ipw-simulation.html#exercises-8"><i class="fa fa-check"></i>Exercises</a>
<ul>
<li class="chapter" data-level="" data-path="ipw-simulation.html"><a href="ipw-simulation.html#exercise-1-simulate"><i class="fa fa-check"></i>Exercise 1: Simulate</a></li>
<li class="chapter" data-level="" data-path="ipw-simulation.html"><a href="ipw-simulation.html#exercise-2-inverse-probability-weighting"><i class="fa fa-check"></i>Exercise 2: Inverse probability weighting</a></li>
<li class="chapter" data-level="" data-path="ipw-simulation.html"><a href="ipw-simulation.html#exercise-3-balance-checking"><i class="fa fa-check"></i>Exercise 3: Balance checking</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="13" data-path="applied-analysis-ipw.html"><a href="applied-analysis-ipw.html"><i class="fa fa-check"></i><b>13</b> Applied Analysis: IPW</a>
<ul>
<li class="chapter" data-level="" data-path="applied-analysis-ipw.html"><a href="applied-analysis-ipw.html#learning-goals-10"><i class="fa fa-check"></i>Learning Goals</a></li>
<li class="chapter" data-level="" data-path="applied-analysis-ipw.html"><a href="applied-analysis-ipw.html#analysis-1"><i class="fa fa-check"></i>Analysis</a>
<ul>
<li class="chapter" data-level="" data-path="applied-analysis-ipw.html"><a href="applied-analysis-ipw.html#data-context-and-research-questions-1"><i class="fa fa-check"></i>Data context and research questions</a></li>
<li class="chapter" data-level="" data-path="applied-analysis-ipw.html"><a href="applied-analysis-ipw.html#loading-data-and-packages"><i class="fa fa-check"></i>Loading data and packages</a></li>
<li class="chapter" data-level="" data-path="applied-analysis-ipw.html"><a href="applied-analysis-ipw.html#part-1-review-outcome-regression-results"><i class="fa fa-check"></i>Part 1: Review outcome regression results</a></li>
<li class="chapter" data-level="" data-path="applied-analysis-ipw.html"><a href="applied-analysis-ipw.html#part-2-propensity-score-modeling"><i class="fa fa-check"></i>Part 2: Propensity score modeling</a></li>
<li class="chapter" data-level="" data-path="applied-analysis-ipw.html"><a href="applied-analysis-ipw.html#part-3-modeling-with-ip-weights"><i class="fa fa-check"></i>Part 3: Modeling with IP weights</a></li>
<li class="chapter" data-level="" data-path="applied-analysis-ipw.html"><a href="applied-analysis-ipw.html#part-4-causal-graphs-and-missing-data"><i class="fa fa-check"></i>Part 4: Causal graphs and missing data</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>IV New Research Questions</b></span></li>
<li class="chapter" data-level="14" data-path="time-varying-treatments-and-mediation-analysis.html"><a href="time-varying-treatments-and-mediation-analysis.html"><i class="fa fa-check"></i><b>14</b> Time-Varying Treatments and Mediation Analysis</a>
<ul>
<li class="chapter" data-level="" data-path="time-varying-treatments-and-mediation-analysis.html"><a href="time-varying-treatments-and-mediation-analysis.html#learning-goals-11"><i class="fa fa-check"></i>Learning Goals</a></li>
<li class="chapter" data-level="" data-path="time-varying-treatments-and-mediation-analysis.html"><a href="time-varying-treatments-and-mediation-analysis.html#exercises-9"><i class="fa fa-check"></i>Exercises</a>
<ul>
<li class="chapter" data-level="" data-path="time-varying-treatments-and-mediation-analysis.html"><a href="time-varying-treatments-and-mediation-analysis.html#exercise-1-7"><i class="fa fa-check"></i>Exercise 1</a></li>
<li class="chapter" data-level="" data-path="time-varying-treatments-and-mediation-analysis.html"><a href="time-varying-treatments-and-mediation-analysis.html#exercise-2-6"><i class="fa fa-check"></i>Exercise 2</a></li>
<li class="chapter" data-level="" data-path="time-varying-treatments-and-mediation-analysis.html"><a href="time-varying-treatments-and-mediation-analysis.html#exercise-3-6"><i class="fa fa-check"></i>Exercise 3</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>V Sensitivity Analyses</b></span></li>
<li class="chapter" data-level="15" data-path="sensitivity-analyses-for-unmeasured-variables.html"><a href="sensitivity-analyses-for-unmeasured-variables.html"><i class="fa fa-check"></i><b>15</b> Sensitivity Analyses for Unmeasured Variables</a>
<ul>
<li class="chapter" data-level="" data-path="sensitivity-analyses-for-unmeasured-variables.html"><a href="sensitivity-analyses-for-unmeasured-variables.html#learning-goals-12"><i class="fa fa-check"></i>Learning Goals</a></li>
<li class="chapter" data-level="" data-path="sensitivity-analyses-for-unmeasured-variables.html"><a href="sensitivity-analyses-for-unmeasured-variables.html#example-with-the-tipr-package"><i class="fa fa-check"></i>Example with the <code>tipr</code> package</a></li>
<li class="chapter" data-level="" data-path="sensitivity-analyses-for-unmeasured-variables.html"><a href="sensitivity-analyses-for-unmeasured-variables.html#discussion-questions"><i class="fa fa-check"></i>Discussion questions</a></li>
</ul></li>
<li class="part"><span><b>VI Homework</b></span></li>
<li class="chapter" data-level="" data-path="homework-1.html"><a href="homework-1.html"><i class="fa fa-check"></i>Homework 1</a>
<ul>
<li class="chapter" data-level="" data-path="homework-1.html"><a href="homework-1.html#general-instructions"><i class="fa fa-check"></i>General instructions</a></li>
<li class="chapter" data-level="" data-path="homework-1.html"><a href="homework-1.html#part-1"><i class="fa fa-check"></i>Part 1</a></li>
<li class="chapter" data-level="" data-path="homework-1.html"><a href="homework-1.html#part-2"><i class="fa fa-check"></i>Part 2</a></li>
<li class="chapter" data-level="" data-path="homework-1.html"><a href="homework-1.html#part-3"><i class="fa fa-check"></i>Part 3</a></li>
<li class="chapter" data-level="" data-path="homework-1.html"><a href="homework-1.html#part-4"><i class="fa fa-check"></i>Part 4</a></li>
<li class="chapter" data-level="" data-path="homework-1.html"><a href="homework-1.html#part-5"><i class="fa fa-check"></i>Part 5</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="homework-2.html"><a href="homework-2.html"><i class="fa fa-check"></i>Homework 2</a>
<ul>
<li class="chapter" data-level="" data-path="homework-2.html"><a href="homework-2.html#general-instructions-1"><i class="fa fa-check"></i>General instructions</a></li>
<li class="chapter" data-level="" data-path="homework-2.html"><a href="homework-2.html#revisions"><i class="fa fa-check"></i>Revisions</a></li>
<li class="chapter" data-level="" data-path="homework-2.html"><a href="homework-2.html#part-1-1"><i class="fa fa-check"></i>Part 1</a></li>
<li class="chapter" data-level="" data-path="homework-2.html"><a href="homework-2.html#part-2-1"><i class="fa fa-check"></i>Part 2</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="homework-3.html"><a href="homework-3.html"><i class="fa fa-check"></i>Homework 3</a>
<ul>
<li class="chapter" data-level="" data-path="homework-3.html"><a href="homework-3.html#general-instructions-2"><i class="fa fa-check"></i>General instructions</a></li>
<li class="chapter" data-level="" data-path="homework-3.html"><a href="homework-3.html#revisions-1"><i class="fa fa-check"></i>Revisions</a></li>
<li class="chapter" data-level="" data-path="homework-3.html"><a href="homework-3.html#clarifying-the-big-picture"><i class="fa fa-check"></i>Clarifying the big picture</a></li>
<li class="chapter" data-level="" data-path="homework-3.html"><a href="homework-3.html#the-smoking-birthweight-paradox"><i class="fa fa-check"></i>The smoking-birthweight paradox</a></li>
<li class="chapter" data-level="" data-path="homework-3.html"><a href="homework-3.html#exchangeability-computation"><i class="fa fa-check"></i>Exchangeability: Computation</a></li>
<li class="chapter" data-level="" data-path="homework-3.html"><a href="homework-3.html#exchangeability-explaining-via-causal-graphs"><i class="fa fa-check"></i>Exchangeability: explaining via causal graphs</a></li>
<li class="chapter" data-level="" data-path="homework-3.html"><a href="homework-3.html#simulation-d-separation-and-exchangeability"><i class="fa fa-check"></i>Simulation, d-separation, and exchangeability</a></li>
<li class="chapter" data-level="" data-path="homework-3.html"><a href="homework-3.html#study-designs-examples-of-applied-studies"><i class="fa fa-check"></i>Study designs: examples of applied studies</a></li>
<li class="chapter" data-level="" data-path="homework-3.html"><a href="homework-3.html#metacognitive-reflection"><i class="fa fa-check"></i>Metacognitive Reflection</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="homework-4.html"><a href="homework-4.html"><i class="fa fa-check"></i>Homework 4</a>
<ul>
<li class="chapter" data-level="" data-path="homework-4.html"><a href="homework-4.html#general-instructions-3"><i class="fa fa-check"></i>General instructions</a></li>
<li class="chapter" data-level="" data-path="homework-4.html"><a href="homework-4.html#revisions-2"><i class="fa fa-check"></i>Revisions</a></li>
<li class="chapter" data-level="" data-path="homework-4.html"><a href="homework-4.html#drawing-causal-graphs"><i class="fa fa-check"></i>Drawing causal graphs</a></li>
<li class="chapter" data-level="" data-path="homework-4.html"><a href="homework-4.html#general-workflow-for-regression-and-ipw"><i class="fa fa-check"></i>General workflow for regression and IPW</a></li>
<li class="chapter" data-level="" data-path="homework-4.html"><a href="homework-4.html#metacognitive-reflection-1"><i class="fa fa-check"></i>Metacognitive Reflection</a></li>
<li class="chapter" data-level="" data-path="homework-4.html"><a href="homework-4.html#final-project-proposal"><i class="fa fa-check"></i>Final Project Proposal</a></li>
</ul></li>
<li class="part"><span><b>VII Project</b></span></li>
<li class="chapter" data-level="" data-path="final-project.html"><a href="final-project.html"><i class="fa fa-check"></i>Final Project</a>
<ul>
<li class="chapter" data-level="" data-path="final-project.html"><a href="final-project.html#project-options"><i class="fa fa-check"></i>Project Options</a>
<ul>
<li class="chapter" data-level="" data-path="final-project.html"><a href="final-project.html#option-1-data-analysis"><i class="fa fa-check"></i>Option 1: Data analysis</a></li>
<li class="chapter" data-level="" data-path="final-project.html"><a href="final-project.html#option-2-blog-posts"><i class="fa fa-check"></i>Option 2: Blog posts</a></li>
<li class="chapter" data-level="" data-path="final-project.html"><a href="final-project.html#option-3-learn-an-advanced-topic"><i class="fa fa-check"></i>Option 3: Learn an advanced topic</a></li>
<li class="chapter" data-level="" data-path="final-project.html"><a href="final-project.html#option-4-other"><i class="fa fa-check"></i>Option 4: Other</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="final-project.html"><a href="final-project.html#deliverables"><i class="fa fa-check"></i>Deliverables</a></li>
<li class="chapter" data-level="" data-path="final-project.html"><a href="final-project.html#timeline"><i class="fa fa-check"></i>Timeline</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://bookdown.org" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">STAT 451: Causal Inference</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="applied-analysis-ipw" class="section level1 hasAnchor" number="13">
<h1><span class="header-section-number">Topic 13</span> Applied Analysis: IPW<a href="applied-analysis-ipw.html#applied-analysis-ipw" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<div id="learning-goals-10" class="section level2 unnumbered hasAnchor">
<h2>Learning Goals<a href="applied-analysis-ipw.html#learning-goals-10" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<ul>
<li>Conduct and interpret results from an appropriate IPW analysis to estimate causal effects and effect modification of causal effects.</li>
</ul>
<p><br></p>
<p>Slides from today are available <a href="https://docs.google.com/presentation/d/1gclqUwHE67Q1dBv8l7TfB_-ePfYBq0v143ycJoKohRc/edit?usp=sharing">here</a>.</p>
<p><br><br><br></p>
</div>
<div id="analysis-1" class="section level2 unnumbered hasAnchor">
<h2>Analysis<a href="applied-analysis-ipw.html#analysis-1" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p><strong>You can download a template RMarkdown file to start from <a href="template_rmds/13-applied-ipw.Rmd">here</a>.</strong></p>
<div id="data-context-and-research-questions-1" class="section level3 unnumbered hasAnchor">
<h3>Data context and research questions<a href="applied-analysis-ipw.html#data-context-and-research-questions-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p><strong>Research questions:</strong> Does a policy that delays the tenure process (for new parents) actually help tenure outcomes? Does it help men and women equally?</p>
<p>The data and full codebook are available <a href="https://moodle.macalester.edu/mod/folder/view.php?id=36846">on Moodle</a> (<code>aer_primarysample.csv</code> and <code>ReadMe.pdf</code>). An abbreviated codebook is below:</p>
<p><strong>Treatment and primary outcome:</strong></p>
<ul>
<li><code>gncs</code>: Is a gender-neutral clock-stopping policy in place at this person’s school? (treatment)</li>
<li><code>tenure_policy_school</code>: Did this person get tenure at the university with the clock-stopping policy? (primary outcome)</li>
</ul>
<p><br></p>
<p><strong>Additional outcomes (mediators):</strong></p>
<ul>
<li><code>top_pubsX</code>: cumulative number of peer-reviewed publications in top-5 journals by year X (3, 5, 7, and 9) since PhD completion</li>
<li><code>PUBSX</code>: cumulative number of non-top-5 peer-reviewed publications by year X (3, 5 7, and 9) since PhD completion</li>
</ul>
<p><br></p>
<p><strong>Additional covariates:</strong></p>
<ul>
<li><code>female</code>: Is the faculty member a female?</li>
<li><code>pol_u</code>: policy university identifier (values are randomized for privacy reasons)</li>
<li><code>pol_job_start</code>: identifier for year the job at the policy university started (values are randomized for privacy reasons)</li>
<li><code>phd_rank</code>: 1-5 categorical variable of PhD program tier based on placements into the top-50 departments in our sample</li>
<li><code>phd_rank_miss</code>: indicator for missing PhD information</li>
<li><code>post_doc</code>: indicator for doing a post-doc before the first tenure-track position</li>
<li><code>ug_students</code>: number of undergraduate students at the university, in thousands</li>
<li><code>grad_students</code>: number of graduate students at the university, in thousands</li>
<li><code>faculty</code>: number of faculty at the university (all disciplines), in hundreds</li>
<li><code>full_av_salary</code>: average salary of full professors at the university, in thousands</li>
<li><code>assist_av_salary</code>: average salary of assistant professors at the university, in thousands,</li>
<li><code>revenue</code>: annual revenue of the university, in 10,000,000s</li>
<li><code>female_ratio</code>: fraction of the faculty at the university who are female</li>
<li><code>full_ratio</code>: fraction of the faculty at the university who are full professors</li>
<li><code>RANK</code>: equal to 1 for top-10 departments and 2 for all other departments</li>
<li><code>max_csstops</code>: number of children born within five years of PhD completion</li>
</ul>
</div>
<div id="loading-data-and-packages" class="section level3 unnumbered hasAnchor">
<h3>Loading data and packages<a href="applied-analysis-ipw.html#loading-data-and-packages" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>You’ll need to install the <code>survey</code> package first.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="applied-analysis-ipw.html#cb14-1" aria-hidden="true"></a><span class="kw">library</span>(survey) <span class="co"># install.packages(&quot;survey&quot;)</span></span>
<span id="cb14-2"><a href="applied-analysis-ipw.html#cb14-2" aria-hidden="true"></a><span class="kw">library</span>(tidyverse)</span>
<span id="cb14-3"><a href="applied-analysis-ipw.html#cb14-3" aria-hidden="true"></a><span class="kw">library</span>(splines) <span class="co"># Make sure that the splines package is installed before running</span></span>
<span id="cb14-4"><a href="applied-analysis-ipw.html#cb14-4" aria-hidden="true"></a></span>
<span id="cb14-5"><a href="applied-analysis-ipw.html#cb14-5" aria-hidden="true"></a>tenure &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="st">&quot;aer_primarysample.csv&quot;</span>)</span>
<span id="cb14-6"><a href="applied-analysis-ipw.html#cb14-6" aria-hidden="true"></a></span>
<span id="cb14-7"><a href="applied-analysis-ipw.html#cb14-7" aria-hidden="true"></a>tenure &lt;-<span class="st"> </span>tenure <span class="op">%&gt;%</span></span>
<span id="cb14-8"><a href="applied-analysis-ipw.html#cb14-8" aria-hidden="true"></a><span class="st">    </span><span class="kw">mutate</span>(</span>
<span id="cb14-9"><a href="applied-analysis-ipw.html#cb14-9" aria-hidden="true"></a>        <span class="dt">faculty =</span> <span class="kw">ifelse</span>(faculty_miss<span class="op">==</span><span class="dv">1</span>, <span class="ot">NA</span>, faculty),</span>
<span id="cb14-10"><a href="applied-analysis-ipw.html#cb14-10" aria-hidden="true"></a>        <span class="dt">revenue =</span> <span class="kw">ifelse</span>(revenue_miss<span class="op">==</span><span class="dv">1</span>, <span class="ot">NA</span>, revenue),</span>
<span id="cb14-11"><a href="applied-analysis-ipw.html#cb14-11" aria-hidden="true"></a>        <span class="dt">female_ratio =</span> <span class="kw">ifelse</span>(female_ratio_miss<span class="op">==</span><span class="dv">1</span>, <span class="ot">NA</span>, female_ratio),</span>
<span id="cb14-12"><a href="applied-analysis-ipw.html#cb14-12" aria-hidden="true"></a>        <span class="dt">full_ratio =</span> <span class="kw">ifelse</span>(full_ratio_miss<span class="op">==</span><span class="dv">1</span>, <span class="ot">NA</span>, full_ratio),</span>
<span id="cb14-13"><a href="applied-analysis-ipw.html#cb14-13" aria-hidden="true"></a>        <span class="dt">phd_rank =</span> <span class="kw">ifelse</span>(phd_rank_miss<span class="op">==</span><span class="dv">1</span>, <span class="ot">NA</span>, phd_rank),</span>
<span id="cb14-14"><a href="applied-analysis-ipw.html#cb14-14" aria-hidden="true"></a>        <span class="dt">max_csstops =</span> <span class="kw">ifelse</span>(max_csstops_miss<span class="op">==</span><span class="dv">1</span>, <span class="ot">NA</span>, max_csstops)</span>
<span id="cb14-15"><a href="applied-analysis-ipw.html#cb14-15" aria-hidden="true"></a>    )</span></code></pre></div>
<p><br></p>
</div>
<div id="part-1-review-outcome-regression-results" class="section level3 unnumbered hasAnchor">
<h3>Part 1: Review outcome regression results<a href="applied-analysis-ipw.html#part-1-review-outcome-regression-results" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Previously we used outcome regression to estimate the overall effect of tenure clock stopping policies and the effects for males and females. Models from one of our analyses are displayed here.</p>
<p>Review the results of this analysis by interpreting the relevant coefficients and confidence intervals on the odds ratio scale.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="applied-analysis-ipw.html#cb15-1" aria-hidden="true"></a><span class="co"># Overall ACE</span></span>
<span id="cb15-2"><a href="applied-analysis-ipw.html#cb15-2" aria-hidden="true"></a>mod_overall &lt;-<span class="st"> </span><span class="kw">glm</span>(tenure_policy_school <span class="op">~</span><span class="st"> </span>gncs <span class="op">+</span><span class="st"> </span><span class="kw">ns</span>(female_ratio, <span class="dv">3</span>) <span class="op">+</span><span class="st"> </span><span class="kw">ns</span>(full_ratio, <span class="dv">3</span>) <span class="op">+</span><span class="st"> </span><span class="kw">factor</span>(max_csstops)<span class="op">*</span>female, <span class="dt">data =</span> tenure, <span class="dt">family =</span> <span class="st">&quot;binomial&quot;</span>)</span>
<span id="cb15-3"><a href="applied-analysis-ipw.html#cb15-3" aria-hidden="true"></a><span class="kw">summary</span>(mod_overall)</span>
<span id="cb15-4"><a href="applied-analysis-ipw.html#cb15-4" aria-hidden="true"></a><span class="kw">confint</span>(mod_overall)</span>
<span id="cb15-5"><a href="applied-analysis-ipw.html#cb15-5" aria-hidden="true"></a></span>
<span id="cb15-6"><a href="applied-analysis-ipw.html#cb15-6" aria-hidden="true"></a><span class="co"># Subgroup ACEs</span></span>
<span id="cb15-7"><a href="applied-analysis-ipw.html#cb15-7" aria-hidden="true"></a>mod_subgroup &lt;-<span class="st"> </span><span class="kw">glm</span>(tenure_policy_school <span class="op">~</span><span class="st"> </span>gncs<span class="op">*</span>female <span class="op">+</span><span class="st"> </span><span class="kw">ns</span>(female_ratio, <span class="dv">3</span>) <span class="op">+</span><span class="st"> </span><span class="kw">ns</span>(full_ratio, <span class="dv">3</span>) <span class="op">+</span><span class="st"> </span><span class="kw">factor</span>(max_csstops)<span class="op">*</span>female, <span class="dt">data =</span> tenure, <span class="dt">family =</span> <span class="st">&quot;binomial&quot;</span>)</span>
<span id="cb15-8"><a href="applied-analysis-ipw.html#cb15-8" aria-hidden="true"></a><span class="kw">summary</span>(mod_subgroup)</span>
<span id="cb15-9"><a href="applied-analysis-ipw.html#cb15-9" aria-hidden="true"></a><span class="kw">confint</span>(mod_subgroup)</span></code></pre></div>
<p><br><br></p>
</div>
<div id="part-2-propensity-score-modeling" class="section level3 unnumbered hasAnchor">
<h3>Part 2: Propensity score modeling<a href="applied-analysis-ipw.html#part-2-propensity-score-modeling" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>We will assume that the <code>revenue</code>, <code>female_ratio</code>, <code>full_ratio</code>, and <code>max_csstops</code> are sufficient (proxies for) variables needed to achieve conditional exchangeability. (<code>female</code> was included in the outcome regresion models for assessing subgroup effects but wasn’t determined to be part of a noncausal path in our causal graph analysis.)</p>
<ul>
<li><p>Fit an appropriate propensity score model called <code>ps_mod</code>. Use visualizations to inform the construction of your model. (Just focus on appropriately handling nonlinearity.)</p></li>
<li><p>Use your model to compute appropriate weights, and add these weights to the dataset.</p></li>
<li><p>Use “before and after” visualizations to compare balance of key variables before and after weighting. You’ll need to use <code>factor(gncs)</code> to make your visualizations–this forces R to view <code>gncs</code> as a categorical variable.</p>
<ul>
<li>Note: If any distributions look dissimilar after weighting, this is an indication that the propensity score model may be misspecified. We won’t address this in our analysis today for time reasons, but in practice, more flexible modeling techniques would be explored.</li>
</ul></li>
</ul>
<p><br></p>
<p>Coding notes:</p>
<p>The code below will be useful for exploring nonlinearity in covariate-treatment relationships. The blue smooth reflects observed data trends, and the red smooth shows the predictions from a logistic regression model with a specific model formula.</p>
<ul>
<li>Formula <code>y ~ x</code>: Covariate is included as a linear term</li>
<li>Formula <code>y ~ ns(x,3)</code>: Covariate is modeled with a flexible nonlinear function (a “spline” with 3 degrees of freedom–don’t worry about the details of this)</li>
</ul>
<p>The model predictions should generally align with observed data trends. If they don’t line up well using formula <code>y ~ x</code>, update the formula to <code>y ~ ns(x, 3)</code> to see if there is an improvement.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="applied-analysis-ipw.html#cb16-1" aria-hidden="true"></a><span class="kw">ggplot</span>(DATA, <span class="kw">aes</span>(<span class="dt">x =</span> COVARIATE, <span class="dt">y =</span> OUTCOME)) <span class="op">+</span></span>
<span id="cb16-2"><a href="applied-analysis-ipw.html#cb16-2" aria-hidden="true"></a><span class="st">    </span><span class="kw">geom_point</span>() <span class="op">+</span></span>
<span id="cb16-3"><a href="applied-analysis-ipw.html#cb16-3" aria-hidden="true"></a><span class="st">    </span><span class="kw">geom_smooth</span>(<span class="dt">se =</span> <span class="ot">FALSE</span>, <span class="dt">color =</span> <span class="st">&quot;blue&quot;</span>, <span class="dt">method =</span> <span class="st">&quot;loess&quot;</span>) <span class="op">+</span></span>
<span id="cb16-4"><a href="applied-analysis-ipw.html#cb16-4" aria-hidden="true"></a><span class="st">    </span><span class="kw">geom_smooth</span>(<span class="dt">formula =</span> INSERT_MODEL_FORMULA, <span class="dt">method =</span> <span class="st">&quot;glm&quot;</span>,</span>
<span id="cb16-5"><a href="applied-analysis-ipw.html#cb16-5" aria-hidden="true"></a>        <span class="dt">method.args =</span> <span class="kw">list</span>(<span class="dt">family=</span><span class="st">&quot;binomial&quot;</span>),</span>
<span id="cb16-6"><a href="applied-analysis-ipw.html#cb16-6" aria-hidden="true"></a>        <span class="dt">se =</span> <span class="ot">FALSE</span>, <span class="dt">color =</span> <span class="st">&quot;red&quot;</span></span>
<span id="cb16-7"><a href="applied-analysis-ipw.html#cb16-7" aria-hidden="true"></a>    )</span></code></pre></div>
<p><br></p>
<p>The (incomplete) code below is useful for computing appropriate weights:</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="applied-analysis-ipw.html#cb17-1" aria-hidden="true"></a>DATA &lt;-<span class="st"> </span>DATA <span class="op">%&gt;%</span></span>
<span id="cb17-2"><a href="applied-analysis-ipw.html#cb17-2" aria-hidden="true"></a><span class="st">    </span><span class="kw">mutate</span>(</span>
<span id="cb17-3"><a href="applied-analysis-ipw.html#cb17-3" aria-hidden="true"></a>        <span class="dt">ps =</span> <span class="kw">predict</span>(ps_mod, <span class="dt">newdata =</span> DATA, <span class="dt">type =</span> <span class="st">&quot;response&quot;</span>),</span>
<span id="cb17-4"><a href="applied-analysis-ipw.html#cb17-4" aria-hidden="true"></a>        <span class="dt">ipw =</span> <span class="kw">case_when</span>(</span>
<span id="cb17-5"><a href="applied-analysis-ipw.html#cb17-5" aria-hidden="true"></a>            TREAT_VAR<span class="op">==</span><span class="dv">1</span> <span class="op">~</span><span class="st"> </span>???,</span>
<span id="cb17-6"><a href="applied-analysis-ipw.html#cb17-6" aria-hidden="true"></a>            TREAT_VAR<span class="op">==</span><span class="dv">0</span> <span class="op">~</span><span class="st"> </span>???</span>
<span id="cb17-7"><a href="applied-analysis-ipw.html#cb17-7" aria-hidden="true"></a>        )</span>
<span id="cb17-8"><a href="applied-analysis-ipw.html#cb17-8" aria-hidden="true"></a>    )</span></code></pre></div>
<p><br></p>
<p>You can incorporate weights into most <code>ggplot2</code> figures by adding <code>weight</code> to the <code>aes</code>thetics:</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="applied-analysis-ipw.html#cb18-1" aria-hidden="true"></a><span class="kw">aes</span>(..., <span class="dt">weight =</span> ip_weight)</span></code></pre></div>
<p><br><br></p>
</div>
<div id="part-3-modeling-with-ip-weights" class="section level3 unnumbered hasAnchor">
<h3>Part 3: Modeling with IP weights<a href="applied-analysis-ipw.html#part-3-modeling-with-ip-weights" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>We can use the IP weights constructed above in a weighted regression model to estimate causal effects.</p>
<ul>
<li><p>Note: The <code>svydesign()</code> and <code>svyglm()</code> functions from the <code>survey</code> package are used to ensure that the weights are treated appropriately. (An updated (“robust”) standard error calculation method is used to appropriately account for the fact that the IP weights are estimated and have uncertainty.)</p></li>
<li><p>Note that we are removing cases with missing values for the weights. (These cases had missing values in the covariates used in the propensity score model.) You’ll think about whether this biases the analysis in Part 4.</p></li>
<li><p>The code for estimating the overall ACE is complete. Adapt this code to estimate subgroup ACEs in males and females.</p></li>
<li><p>Using both the confidence intervals and effect magnitudes, discuss the results of your analysis in a contextually meaningful way. (Tie these results back to the research questions.)</p></li>
<li><p>How do confidence interval widths compare to those from outcome regression?</p></li>
</ul>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="applied-analysis-ipw.html#cb19-1" aria-hidden="true"></a><span class="co"># Remove cases with missing weights</span></span>
<span id="cb19-2"><a href="applied-analysis-ipw.html#cb19-2" aria-hidden="true"></a>tenure_subs &lt;-<span class="st"> </span>tenure <span class="op">%&gt;%</span></span>
<span id="cb19-3"><a href="applied-analysis-ipw.html#cb19-3" aria-hidden="true"></a><span class="st">    </span><span class="kw">filter</span>(<span class="op">!</span><span class="kw">is.na</span>(ipw))</span>
<span id="cb19-4"><a href="applied-analysis-ipw.html#cb19-4" aria-hidden="true"></a></span>
<span id="cb19-5"><a href="applied-analysis-ipw.html#cb19-5" aria-hidden="true"></a><span class="co"># Set up information about weights</span></span>
<span id="cb19-6"><a href="applied-analysis-ipw.html#cb19-6" aria-hidden="true"></a>design &lt;-<span class="st"> </span><span class="kw">svydesign</span>(<span class="dt">ids =</span> <span class="op">~</span><span class="dv">0</span>, <span class="dt">weights =</span> tenure_subs<span class="op">$</span>ipw, <span class="dt">data =</span> tenure_subs)</span>
<span id="cb19-7"><a href="applied-analysis-ipw.html#cb19-7" aria-hidden="true"></a></span>
<span id="cb19-8"><a href="applied-analysis-ipw.html#cb19-8" aria-hidden="true"></a><span class="co"># Fit a marginal structural model to estimate overall ACE</span></span>
<span id="cb19-9"><a href="applied-analysis-ipw.html#cb19-9" aria-hidden="true"></a>overall_fit &lt;-<span class="st"> </span><span class="kw">svyglm</span>(</span>
<span id="cb19-10"><a href="applied-analysis-ipw.html#cb19-10" aria-hidden="true"></a>    tenure_policy_school <span class="op">~</span><span class="st"> </span>gncs,</span>
<span id="cb19-11"><a href="applied-analysis-ipw.html#cb19-11" aria-hidden="true"></a>    <span class="dt">data =</span> tenure_subs,</span>
<span id="cb19-12"><a href="applied-analysis-ipw.html#cb19-12" aria-hidden="true"></a>    <span class="dt">design =</span> design,</span>
<span id="cb19-13"><a href="applied-analysis-ipw.html#cb19-13" aria-hidden="true"></a>    <span class="dt">family =</span> <span class="st">&quot;quasibinomial&quot;</span></span>
<span id="cb19-14"><a href="applied-analysis-ipw.html#cb19-14" aria-hidden="true"></a>)</span>
<span id="cb19-15"><a href="applied-analysis-ipw.html#cb19-15" aria-hidden="true"></a><span class="kw">summary</span>(overall_fit)</span>
<span id="cb19-16"><a href="applied-analysis-ipw.html#cb19-16" aria-hidden="true"></a><span class="kw">confint</span>(overall_fit)</span>
<span id="cb19-17"><a href="applied-analysis-ipw.html#cb19-17" aria-hidden="true"></a></span>
<span id="cb19-18"><a href="applied-analysis-ipw.html#cb19-18" aria-hidden="true"></a><span class="co"># Adapt the svyglm() code above to include an interaction between treatment and female</span></span>
<span id="cb19-19"><a href="applied-analysis-ipw.html#cb19-19" aria-hidden="true"></a>subgroup_fit &lt;-<span class="st"> </span></span></code></pre></div>
<p><br><br></p>
</div>
<div id="part-4-causal-graphs-and-missing-data" class="section level3 unnumbered hasAnchor">
<h3>Part 4: Causal graphs and missing data<a href="applied-analysis-ipw.html#part-4-causal-graphs-and-missing-data" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Challenge! How might we use causal graphs to analyze the impact of dropping missing data (a complete case analysis)? Can we use ideas from representing selection bias with causal graphs?</p>

</div>
</div>
</div>



            </section>

          </div>
        </div>
      </div>
<a href="ipw-simulation.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="time-varying-treatments-and-mediation-analysis.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": false,
"twitter": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "section"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
